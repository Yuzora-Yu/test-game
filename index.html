<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>オーイシSSA 物販計算ツール</title>
  <style>
    :root { --w: min(1100px, 96vw); --gap: 12px; }
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Sans", "Noto Sans JP", "Yu Gothic UI", sans-serif; line-height: 1.6; margin: 0; color: #222; background: #fafafa; }
    header, main, footer { width: var(--w); margin: 20px auto; }
    header h1 { margin: 8px 0 0; font-size: clamp(20px, 3.4vw, 28px); }
    header p { margin: 6px 0 0; color: #555; }
    .toolbar { display: flex; gap: 8px; flex-wrap: wrap; margin: 12px 0 0; }
    .toolbtn { padding: 8px 12px; border: 1px solid #ccc; background: #fff; border-radius: 6px; cursor: pointer; }
    .toolbtn.primary { background:#b80d21; color:#fff; border-color:#b80d21; }
    .toolbtn:disabled { opacity:.5; cursor:not-allowed; }

    table { width: 100%; border-collapse: collapse; background:#fff; }
    thead th { position: sticky; top: 0; background:#f4f4f4; }
    th, td { border-bottom: 1px solid #eee; padding: 10px 8px; text-align: left; }
    th.num, td.num { text-align: right; white-space: nowrap; }
    input.qty { width: 80px; padding: 6px 8px; text-align: right; }
    tfoot td { background:#fbfbfb; font-weight: 600; }
    .note { color:#666; font-size: 12px; }

    /* 結果カード（画像保存対象） */
    #resultCard { background:#fff; border:1px solid #eee; border-radius:8px; padding:16px; margin-top:16px; box-shadow: 0 8px 26px rgba(0,0,0,.04); }

    /* ▼下部リスト：左=商品名 / 右=（×）数量（＝）金額 を固定幅で整列 */
    #summaryList { margin: 8px 0 0; padding-left: 1.2em; }
    #summaryList li { margin: 2px 0; list-style: disc; }
    .summary-row {
      display: grid;
      /* name | × | qty(3桁) | ＝ | amount(¥+7桁+カンマ分) */
      grid-template-columns: 1fr auto 4ch auto 11ch;
      column-gap: 6px;
      align-items: baseline;
    }
    /* 数値は等幅＆タブラーで幅ブレ回避 */
    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Noto Sans Mono CJK JP", monospace;
      font-variant-numeric: tabular-nums;
      letter-spacing: 0; /* 一部の等幅での間延び防止 */
    }
    .summary-name { min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .summary-sym  { opacity: .9; }           /* 「×」「＝」 */
    .summary-qty  { text-align: right; }     /* 3桁想定 → 4ch（前後余白含む） */
    .summary-amt  { text-align: right; }     /* 「¥9,999,999」想定 → 11ch */
    /* 任意：スマホで右側が詰まりすぎる場合は少し余白 */
    @media (max-width: 420px){
      .summary-row { column-gap: 4px; grid-template-columns: 1fr auto 4ch auto 12ch; }
    }

    .badge { display:inline-block; padding: 2px 8px; border-radius: 999px; background:#b80d21; color:#fff; font-weight:700; }

    .grid { display:grid; gap: var(--gap); grid-template-columns: 1fr; }
    @media (min-width: 880px){ .grid { grid-template-columns: 1fr; } }
  </style>
  <script src="https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>
<body>
<header>
  <h1>オーイシSSA ライブ物販 計算ツール</h1>
  <p class="note">数量を入れると自動計算されます。価格は税込想定。必要に応じて品目の一覧はコード内の <code>ITEMS</code> を編集してください。</p>
  <div class="toolbar">
    <button class="toolbtn" id="btnReset">数量をクリア</button>
    <button class="toolbtn" id="btnSample">数量をサンプル入力</button>
  </div>
</header>

<main class="grid">
  <section>
    <table id="itemsTable" aria-label="商品一覧">
      <thead>
        <tr>
          <th style="width:48%">商品名</th>
          <th class="num" style="width:14%">単価</th>
          <th class="num" style="width:18%">購入数</th>
          <th class="num" style="width:20%">小計</th>
        </tr>
      </thead>
      <tbody id="itemsBody"></tbody>
      <tfoot>
        <tr>
          <td>合計</td>
          <td class="num" id="footUnit"></td>
          <td class="num"><span id="footCount">0</span> 点</td>
          <td class="num"><span id="footTotal">¥0</span></td>
        </tr>
      </tfoot>
    </table>

    <!-- ここが保存対象（ボタンは外側に出しました） -->
    <div id="resultCard">
      <div><span class="badge" id="badgeCount">0 点</span> / 合計 <strong id="grandTotal">¥0</strong></div>
      <ul id="summaryList" aria-live="polite"></ul>
    </div>

    <!-- ボタンは枠の外（画像に入らない） -->
    <div class="toolbar">
      <button class="toolbtn" id="btnSaveImg">この内容を画像保存</button>
      <button class="toolbtn primary" id="btnTweet">Tweet（文面を作成）</button>
    </div>
  </section>
</main>

<footer class="note">
  <p>※Web仕様上、ツイートに画像を自動添付することはできません。まず「画像保存」で保存→ツイート画面で画像を添付してください。</p>
  <p>※非公式の個人ツールです。価格・品目はお手元でご確認ください。</p>
</footer>

<script>
/* ---- 品目定義 ---- */
const ITEMS = [
  { key:"tshirt_white", name:"Tシャツ WHITE", price:5000 },
  { key:"tshirt_pigment", name:"Tシャツ PIGMENT BLACK", price:5000 },
  { key:"longsleeve_logo", name:"ロングT WHITE（CLUB014限定）", price:6500 },
  { key:"denim_shirt", name:"デニムシャツ", price:9500 },
  { key:"knit_cap", name:"ニットキャップ", price:3900 },
  { key:"shoulder_bag", name:"ショルダーバッグ", price:7700 },
  { key:"metallic_pouch", name:"メタリックポーチ", price:2500 },
  { key:"sports_towel", name:"スポーツタオル", price:2500 },
  { key:"penlight", name:"ペンライト", price:3800 },
  { key:"rubber_band_day1", name:"ラバーバンド（Day1カラー）", price:600 },
  { key:"rubber_band_day2", name:"ラバーバンド（Day2カラー）", price:600 },
  { key:"miniyoshi", name:"ミニヨシ オーイシSSA ver", price:3300 },
  { key:"kusorip", name:"おしゃべりクソリップ", price:900 },
  { key:"acrylic_keyholder", name:"証明写真風キーホルダー 全5種", price:700 },
  { key:"bins_day1", name:"オーイシSSAビンズ（Day1デザイン）", price:1000 },
  { key:"bins_day2", name:"オーイシSSAビンズ（Day2デザイン）", price:1000 },
  { key:"big_acrylic", name:"BIGステッカー＆スマホステッカー", price:900 },
  { key:"shopper", name:"ショッパー", price:600 },

  { key:"glasses_case", name:"メガネケースセット", price:6000 },
  { key:"bucket_shoulder", name:"ドロストショルダーバッグ", price:4000 },
  { key:"bucket_hat", name:"バケットハット", price:3800 },
  { key:"neckstrap", name:"オーイシ武道館ネックストラップ", price:1800 },
  { key:"lanyard", name:"マイクマサ ランダムアクリルキーホルダー 全4種", price:1200 },
  { key:"tshirt_silkwhite", name:"Tシャツ SILK WHITE（31・32）", price:6000 },
  { key:"tshirt_pigmentA", name:"Tシャツ PIGMENT BLACK（33・34）", price:6000 },
  { key:"tshirt_pigmentB", name:"Tシャツ PIGMENT BLACK（35・36）", price:6000 },
  { key:"trainer_black", name:"トラックジャケット BLACK", price:12000 },
  { key:"pants_black", name:"パンツ BLACK", price:9000 },
  { key:"pants_yellow", name:"パンツ YELLOW", price:9000 },
  { key:"cap", name:"キャップ", price:4000 },
  { key:"boxer_gray", name:"ボクサーパンツ GRAY", price:4500 },
  { key:"boxer_yellow", name:"ボクサーパンツ YELLOW", price:4500 },
  { key:"socks_white", name:"ソックス WHITE×YELLOW", price:2500 },
  { key:"socks_gray", name:"ソックス GRAY×YELLOW", price:2500 },
  { key:"towel_vol2", name:"オーイシ武道館Vol.2 スポーツタオル", price:2500 },
  { key:"penlight_vol2", name:"オーイシ武道館Vol.2 ペンライト", price:1900 },
  { key:"sensu", name:"オーイシ武道館Vol.2 クリアうちわ", price:1900 },
  { key:"beadsstrap", name:"オーイシ武道館Vol.2 スマホビーズストラップ", price:1900 },
  { key:"overall", name:"オーイシマサヨシ×Leeコラボ オーバーオール", price:19800 },
  { key:"tshirt_powerA", name:"J-POWERコラボTシャツ（エレクトリックパレード）", price:3000 },
  { key:"tshirt_powerB", name:"J-POWERコラボTシャツ（でんき犬）", price:3000 },
  { key:"towel_power", name:"J-POWERコラボタオル（でんき犬）", price:2000 },

  { key:"gachaA", name:"ガチャA（全13種）", price:500 },
  { key:"gachaB", name:"ガチャB（全12種＋シークレット1種）", price:500 },
];

/* ---- ユーティリティ ---- */
const yen = n => "¥" + n.toLocaleString("ja-JP");
const clampInt = v => {
  if (v === "" || v === null || v === undefined) return 0;
  const n = parseInt(v, 10);
  return Math.max(0, Math.min(9999, Number.isFinite(n) ? n : 0));
};

/* ---- テーブル描画 ---- */
const tbody = document.getElementById("itemsBody");
const inputs = {};
function renderTable() {
  tbody.innerHTML = "";
  for (const item of ITEMS) {
    const tr = document.createElement("tr");

    const tdName = document.createElement("td");
    tdName.textContent = item.name;
    tr.appendChild(tdName);

    const tdPrice = document.createElement("td");
    tdPrice.className = "num";
    tdPrice.textContent = yen(item.price);
    tr.appendChild(tdPrice);

    const tdQty = document.createElement("td");
    tdQty.className = "num";
    const input = document.createElement("input");
    input.type = "number";
    input.min = "0"; input.max = "9999";
    input.value = "";             // 初期は空欄
    input.placeholder = "0";
    input.className = "qty";
    input.id = "qty_" + item.key;
    input.addEventListener("input", updateAll);
    inputs[item.key] = input;
    tdQty.appendChild(input);
    tr.appendChild(tdQty);

    const tdSub = document.createElement("td");
    tdSub.className = "num";
    tdSub.id = "sub_" + item.key;
    tdSub.textContent = yen(0);
    tr.appendChild(tdSub);

    tbody.appendChild(tr);
  }
}
renderTable();

/* ---- 計算とサマリー ---- */
function getCart() {
  const cart = [];
  for (const item of ITEMS) {
    const qty = clampInt(inputs[item.key].value);
    if (qty > 0) cart.push({ ...item, qty, subtotal: item.price * qty });
  }
  return cart;
}
function updateAll() {
  const cart = getCart();
  for (const item of ITEMS) {
    const qty = clampInt(inputs[item.key].value);
    document.getElementById("sub_" + item.key).textContent = yen(item.price * qty);
  }
  const totalCount = cart.reduce((a,c)=>a+c.qty, 0);
  const totalPrice = cart.reduce((a,c)=>a+c.subtotal, 0);
  document.getElementById("footCount").textContent = totalCount.toLocaleString("ja-JP");
  document.getElementById("footTotal").textContent = yen(totalPrice);
  document.getElementById("badgeCount").textContent = `${totalCount.toLocaleString("ja-JP")} 点`;
  document.getElementById("grandTotal").textContent = yen(totalPrice);

  const ul = document.getElementById("summaryList");
  ul.innerHTML = "";
  if (cart.length === 0) {
    const li = document.createElement("li");
    li.textContent = "購入品はまだありません。";
    ul.appendChild(li);
  } else {
    // 下部リスト：固定幅カラムで数量・金額をピシッと揃える
    for (const row of cart) {
      const li   = document.createElement("li");
      const rowDiv = document.createElement("div");
      rowDiv.className = "summary-row";

      const name  = document.createElement("span");
      name.className = "summary-name";
      name.textContent = row.name;

      const symX  = document.createElement("span");
      symX.className = "summary-sym";
      symX.textContent = "×";

      const qty   = document.createElement("span");
      qty.className = "summary-qty mono";
      qty.textContent = row.qty.toLocaleString("ja-JP"); // 1〜999想定

      const symEq = document.createElement("span");
      symEq.className = "summary-sym";
      symEq.textContent = "＝";

      const amt   = document.createElement("span");
      amt.className = "summary-amt mono";
      amt.textContent = yen(row.subtotal); // 「¥9,999,999」まで想定

      rowDiv.append(name, symX, qty, symEq, amt);
      li.appendChild(rowDiv);
      ul.appendChild(li);
    }
  }
}
updateAll();

/* ---- 操作ボタン ---- */
document.getElementById("btnReset").addEventListener("click", () => {
  for (const k in inputs) inputs[k].value = "";
  updateAll();
});
document.getElementById("btnSample").addEventListener("click", () => {
  const preset = { tshirt_white:1, penlight:1, rubber_band_day1:2, gachaA:4, cap:1 };
  for (const k in inputs) inputs[k].value = preset[k] ?? "";
  updateAll();
});

/* ---- 画像保存（枠= #resultCard のみ） ---- */
document.getElementById("btnSaveImg").addEventListener("click", async () => {
  const target = document.getElementById("resultCard");
  const canvas = await html2canvas(target, { scale: 2, backgroundColor: "#ffffff" });
  const link = document.createElement("a");
  link.download = `oishi-ssa-goods_${new Date().toISOString().slice(0,10)}.png`;
  link.href = canvas.toDataURL("image/png");
  link.click();
});

/* ---- Tweet（合計点数と合計金額のみ） ---- */
document.getElementById("btnTweet").addEventListener("click", () => {
  const cart = getCart();
  const totalCount = cart.reduce((a,c)=>a+c.qty, 0);
  const totalPrice = cart.reduce((a,c)=>a+c.subtotal, 0);
  const textLine = `購入予定：${totalCount}点 / 合計 ${yen(totalPrice)}`;
  const hashtags = ["オーイシマサヨシ","オーイシSSA"].join(",");
  const text = encodeURIComponent(textLine);
  const url  = encodeURIComponent(location.href);
  const intent = `https://twitter.com/intent/tweet?text=${text}&url=${url}&hashtags=${hashtags}`;
  window.open(intent, "_blank");
});
</script>
</body>
</html>
